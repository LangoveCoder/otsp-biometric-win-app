<Page x:Class="BiometricSuperAdmin.Views.TestManagementView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Test Management"
      Background="#FAFAFA">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Page Title -->
        <TextBlock Grid.Row="0"
                   Text="Test Management"
                   Style="{StaticResource PageTitle}"/>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Tests List -->
            <Border Grid.Column="0" 
                    Style="{StaticResource StatsCard}"
                    Margin="0,0,12,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header with buttons -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
                        <Button x:Name="AddTestButton" 
                                Style="{StaticResource PrimaryButton}"
                                Click="AddTestButton_Click"
                                Content="âž• Add Test"/>
                        <Button x:Name="RefreshButton"
                                Style="{StaticResource SecondaryButton}"
                                Click="RefreshButton_Click"
                                Content="ðŸ”„ Refresh"/>
                    </StackPanel>

                    <!-- Tests DataGrid -->
                    <DataGrid x:Name="TestsDataGrid"
                              Grid.Row="1"
                              Style="{StaticResource CustomDataGrid}"
                              SelectionChanged="TestsDataGrid_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Test Name" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Code" Binding="{Binding Code}" Width="Auto"/>
                            <DataGridTextColumn Header="College" Binding="{Binding College.Name}" Width="*"/>
                            <DataGridTextColumn Header="Test Date" Binding="{Binding TestDate, StringFormat=dd-MMM-yyyy}" Width="Auto"/>
                            <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="Auto"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                        <Button x:Name="EditButton"
                                Style="{StaticResource SecondaryButton}"
                                Click="EditButton_Click"
                                IsEnabled="False"
                                Content="âœï¸ Edit"/>
                        <Button x:Name="DeleteButton"
                                Style="{StaticResource SecondaryButton}"
                                Click="DeleteButton_Click"
                                IsEnabled="False"
                                Content="ðŸ—‘ï¸ Delete"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Test Details / Add-Edit Form -->
            <Border Grid.Column="1"
                    Style="{StaticResource StatsCard}"
                    Margin="12,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="TestFormPanel">
                        <TextBlock x:Name="FormTitle"
                                 Text="Test Details"
                                 Style="{StaticResource SectionHeader}"/>

                        <!-- College Selection (FIRST - Required) -->
                        <TextBlock Text="Select College *" FontWeight="Medium" Margin="0,16,0,4"/>
                        <ComboBox x:Name="CollegeComboBox"
                                Height="40"
                                DisplayMemberPath="Name"
                                Margin="0,8"
                                BorderBrush="#CCCCCC"
                                BorderThickness="1"/>

                        <!-- Test Name -->
                        <TextBlock Text="Test Name *" FontWeight="Medium" Margin="0,16,0,4"/>
                        <TextBox x:Name="TestNameTextBox"
                               Style="{StaticResource CustomTextField}"/>

                        <!-- Test Code -->
                        <TextBlock Text="Test Code *" FontWeight="Medium" Margin="0,16,0,4"/>
                        <TextBox x:Name="TestCodeTextBox"
                               Style="{StaticResource CustomTextField}"/>

                        <!-- Description -->
                        <TextBlock Text="Description" FontWeight="Medium" Margin="0,16,0,4"/>
                        <TextBox x:Name="DescriptionTextBox"
                               TextWrapping="Wrap"
                               AcceptsReturn="True"
                               Height="80"
                               VerticalScrollBarVisibility="Auto"
                               Padding="12"
                               BorderBrush="#CCCCCC"
                               BorderThickness="1"
                               Margin="0,8"/>

                        <!-- Test Date -->
                        <TextBlock Text="Test Date *" FontWeight="Medium" Margin="0,16,0,4"/>
                        <DatePicker x:Name="TestDatePicker"
                                  Height="40"
                                  Margin="0,8"
                                  BorderBrush="#CCCCCC"
                                  BorderThickness="1"/>

                        <!-- Registration Start Date -->
                        <TextBlock Text="Registration Start Date *" FontWeight="Medium" Margin="0,16,0,4"/>
                        <DatePicker x:Name="RegStartDatePicker"
                                  Height="40"
                                  Margin="0,8"
                                  BorderBrush="#CCCCCC"
                                  BorderThickness="1"/>

                        <!-- Registration End Date -->
                        <TextBlock Text="Registration End Date *" FontWeight="Medium" Margin="0,16,0,4"/>
                        <DatePicker x:Name="RegEndDatePicker"
                                  Height="40"
                                  Margin="0,8"
                                  BorderBrush="#CCCCCC"
                                  BorderThickness="1"/>

                        <!-- Is Active -->
                        <CheckBox x:Name="IsActiveCheckBox"
                                Content="Active Test"
                                Margin="0,16,0,0"
                                FontWeight="Medium"
                                IsChecked="True"/>

                        <!-- Form Buttons -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,24,0,0">
                            <Button x:Name="CancelButton"
                                  Style="{StaticResource SecondaryButton}"
                                  Click="CancelButton_Click"
                                  Content="âŒ Cancel"
                                  Visibility="Collapsed"/>
                            <Button x:Name="SaveButton"
                                  Style="{StaticResource PrimaryButton}"
                                  Click="SaveButton_Click"
                                  Content="ðŸ’¾ Save"
                                  Visibility="Collapsed"/>
                        </StackPanel>

                        <!-- Info Panel (when no test selected) -->
                        <Border x:Name="InfoPanel"
                              Background="#F3E5F5"
                              Padding="16"
                              CornerRadius="4"
                              Margin="0,24,0,0">
                            <StackPanel>
                                <TextBlock Text="â„¹ï¸ Instructions" FontWeight="Bold" Margin="0,0,0,8"/>
                                <TextBlock Text="â€¢ Select a college first, then create a test for it" TextWrapping="Wrap" Margin="0,4"/>
                                <TextBlock Text="â€¢ Each test belongs to ONE college" TextWrapping="Wrap" Margin="0,4"/>
                                <TextBlock Text="â€¢ Click 'Add Test' to create a new test" TextWrapping="Wrap" Margin="0,4"/>
                                <TextBlock Text="â€¢ Select a test from the list to view details" TextWrapping="Wrap" Margin="0,4"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay"
              Grid.Row="0"
              Grid.RowSpan="2"
              Background="#80000000"
              Visibility="Collapsed">
            <Border HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Background="White"
                    Padding="40"
                    CornerRadius="8">
                <StackPanel>
                    <TextBlock Text="â³" FontSize="48" HorizontalAlignment="Center"/>
                    <TextBlock Text="Processing..."
                             FontSize="16"
                             Margin="0,16,0,0"
                             HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
